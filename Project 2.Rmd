---
title: "Project 2"
author: "Sarah Fraschetti"
date: "11/10/2021"
output: html_document
---

```{r setup, include=FALSE}

library(readr)

Top_Colleges_2019 <- read_csv("data/ForbesAmericasTopColleges2019.csv")

Top_Colleges_2019

Top_Colleges_2019_cleaned <- na.omit(Top_Colleges_2019) 

```

```{r}

Top_Colleges_2019_cleaned$State <- factor(Top_Colleges_2019_cleaned$State)
levels(Top_Colleges_2019_cleaned$State)
nlevels(Top_Colleges_2019_cleaned$State)

median_scores <- data.frame("State" = levels(Top_Colleges_2019_cleaned$State), 
                            "Medians" = rep(NA, length = nlevels(Top_Colleges_2019_cleaned$State)))


# Loop:

calculate_medians <- function(Top_Colleges_2019_cleaned, college_data){
  median_scores <- data.frame("State" = levels(Top_Colleges_2019_cleaned$State), 
                            "Medians" = rep(NA, length = nlevels(Top_Colleges_2019_cleaned$State)))
  for (x in median_scores$State) {
    median_scores$Medians[median_scores$State == x] <- 
      median(Top_Colleges_2019_cleaned[[college_data]][Top_Colleges_2019_cleaned$State == x])
  }
  return(median_scores)
}

median_scores <- calculate_medians(Top_Colleges_2019_cleaned, "Rank")
median_scores_pop <- calculate_medians(Top_Colleges_2019_cleaned, "Student Population")

# Install necessary packages: 

library(ggplot2)
library(maps)
library(mapproj)
library(dplyr)

# Create map showing the median ranking of colleges in each state. 


map_colleges <- merge(Top_Colleges_2019_cleaned, median_scores, by = "State")

names(map_colleges)[1] <- "region"

map_colleges$region <- tolower(state.name[match(map_colleges$region, state.abb)])
map_colleges <- na.omit(map_colleges)

Main_States <- map_data("state")

Merged_States <- inner_join(Main_States, map_colleges, by = "region")
  

# Plot Base Map

ggplot() + 
  geom_polygon(data = Main_States, aes(x = long, y = lat, group = group), 
                color = "black", fill = "lightblue")

# Plot Median College Rankings on Map

p <- ggplot(Merged_States, aes(x = long, y = lat, group = group, fill = Medians)) + 
  geom_polygon(color = "white", size = 0.2) + ggtitle("Median College Ranking By State") + scale_fill_viridis_c() + theme_void()

p$labels$fill <- "Median Ranking"

p

# median population data 
map_colleges <- merge(Top_Colleges_2019_cleaned, median_scores_pop, by = "State")

names(map_colleges)[1] <- "region"

map_colleges$region <- tolower(state.name[match(map_colleges$region, state.abb)])
map_colleges <- na.omit(map_colleges)

Main_States <- map_data("state")

Merged_States <- inner_join(Main_States, map_colleges, by = "region")

# plot map for pop

p <- ggplot(Merged_States, aes(x = long, y = lat, group = group, fill = Medians)) + 
  geom_polygon(color = "white", size = 0.2) + ggtitle("Median College Ranking By State") + scale_fill_viridis_c() + theme_void()

p$labels$fill <- "Median Ranking"

p
```


```

